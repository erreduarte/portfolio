Common Table Expressions (CTEs):

    CTEs (WITH clause) allow you to define temporary result sets that can be used within subsequent SELECT, INSERT, UPDATE, or DELETE statements. In this YAML representation, the CTEs define two separate datasets: ecommerce_orders and subscriptions_orders.

ecommerce_orders CTE:

    This CTE retrieves data from a source referenced by {{ref ('base_ecommerce_orders')}}. It selects specific columns (id, created_at, customer_id, etc.) and performs operations like extracting shipment status from JSON data (fulfillments) and handling null values in fulfillment_status.

subscriptions_orders CTE:

    This CTE retrieves data from {{ref ('subscriptions_subscriptions')}}, selecting columns (uuid, created_at, account_code, etc.) and assigning static values ('subscriptions') to certain columns like store.

sales_orders CTE:

    This CTE combines data from both ecommerce_orders and subscriptions_orders using UNION, which merges the results while removing duplicates.

Final SELECT Statement:

    The final SELECT * FROM sales_orders; statement retrieves all columns from the sales_orders CTE. This is the output of the entire query, combining data from both ecommerce and subscriptions into a unified dataset.
